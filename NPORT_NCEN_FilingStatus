EXEC sp_set_session_context @key=N'SystemUserName', @value='SYSTEM'

SELECT
DISTINCT

--CLIENT
cl.Name as ClientName
,cl.ClientCode as ClientCode
,cl.ClientID

--COMPLEX
,cx.Name as ComplexName
,cx.ComplexCode as ComplexCode

--FUND GROUP
,fg.Name as FundGroupName
,fg.FundGroupCode as FundGroupCode

--FUND
,fnd.Name as FundName
,fnd.FundCode

--CLASS
--,fc.Name as ClassName
--,fc.FundClassCode

--FUND CREATED DATE
,CAST(fnd.CreatedDateTime as date) as FundCreatedDate
,CAST(fnd.CreatedDateTime as time(0)) as FundCreatedTime

--Filing Info
,ff.filingfundid as FilingFundID
,f.filingid as FilingID
,a.label as AccountPeriod
,fo.name as Form
,filsub.SubmittedDateTime as Filing_Submission_DateTime
,CAST(filsub.SubmittedDateTime as DATE) as FilingSubmitDate
,CAST(filsub.SubmittedDateTime as TIME (0)) as FilingSubmitTime
--,filsubdet.Message as FilingSubmitMessage
,case when filsubdet.Message like '%ACCEPTED%' then 1 else 0 end as SEC_Accepted
,filsubdet.FilingSubmissionDetailID as FilingSubmitDetailID


FROM dbo.Client as cl
JOIN dbo.Complex as cx on cl.ClientID = cx.ClientID
JOIN dbo.FundGroup as fg on cx.ComplexID = fg.ComplexID
JOIN dbo.Fund as fnd on fg.FundGroupID = fnd.FundGroupID


--INNER JOIN dbo.FundClass as fc on cx.ComplexID = fc.ComplexID

JOIN dbo.FilingFund ff on fnd.FundID = ff.FundID
JOIN dbo.Filing f on ff.filingid = f.filingid
JOIN dbo.AccountPeriod a on f.accountperiodid = a.accountperiodid
JOIN dbo.Form fo on a.formid = fo.formid
JOIN dbo.FilingSubmission filsub on ff.FilingID = filsub.FilingID
JOIN dbo.FilingSubmissionDetail filsubdet on filsub.FilingSubmissionID = filsubdet.FilingSubmissionID
JOIN dbo.FilingSubmissionDetailType filsubdettype on filsubdet.FilingSubmissionDetailTypeId = filsubdettype.FilingSubmissionDetailTypeID


WHERE fnd.IsActive = 1
