EXEC sp_set_session_context @key=N'SystemUserName', @value='SYSTEM'

SELECT

--Registrant
reg.FullLegalName

--Fund Name 
,fund.Name as FundName

--Form
,form.Name as FormName

--AccountPeriodEnd
,ap.Label as AccountPeriod

--Fund Created Date
,fund.CreatedDateTime as FundCreatedDateTime
,CAST(fund.CreatedDateTime as DATE) as FundCreatedDate
,CAST(fund.CreatedDateTime as TIME(0)) as FundCreatedTime
,filfund.CreatedDateTime as FilingFundCreated

--Form Submission Date
,filsub.SubmittedDateTime as FilingSubmitDateTime
,CAST(filsub.SubmittedDateTime as DATE) as FilingSubmitDate
,CAST(filsub.SubmittedDateTime as TIME(0)) as FilingSubmitTime

--Filing Status
,filsub.FilingStatusID as FilingStatusID
,filstat.Name as FilingStatus
,filsub.AccessionNumber as FilingAccessionNumber
,filsub.FilingSubmissionID as FilingSubmissionID

FROM dbo.FilingSubmission filsub

JOIN dbo.FilingStatus filstat
ON filsub.FilingStatusID = filstat.FilingStatusID

JOIN dbo.FilingFund filfund
ON filsub.FilingID = filfund.FilingID

JOIN dbo.Filing fil
ON filfund.FilingID = fil.FilingID

JOIN dbo.AccountPeriod ap
ON fil.AccountPeriodID = ap.AccountPeriodID

JOIN dbo.Form form
ON ap.FormID = form.FormID

JOIN dbo.Fund fund
ON filfund.FundID = fund.FundID

LEFT JOIN dbo.FilingRegistrant filreg
ON filfund.FilingID = filreg.FilingID

LEFT JOIN dbo.Registrant reg
ON filreg.RegistrantID = reg.RegistrantID

ORDER BY filsub.SubmittedDateTime DESC
